@model IEnumerable<guia_turistico.Models.Tipos>

@{
    ViewData["Title"] = "Inicio - Guía Turística";
    var selectedLanguage = Context.Request.Cookies["selectedLanguage"] ?? "es";
}

<!-- Encabezado -->
<header class="py-5 text-center">
    <div class="container">
        <h1 class="fw-bold mb-3">
            @switch (selectedLanguage)
            {
                case "en":
                    <text>Discover the Best Tourist Destinations</text>
                    break;
                case "pt":
                    <text>Descubra os Melhores Destinos Turísticos</text>
                    break;
                default:
                    <text>Descubre los mejores destinos turísticos</text>
                    break;
            }
        </h1>
        <p class="lead">
            @switch (selectedLanguage)
            {
                case "en":
                    <text>Explore, learn and live unique experiences with our guide</text>
                    break;
                case "pt":
                    <text>Explore, aprenda e viva experiências únicas com o nosso guia</text>
                    break;
                default:
                    <text>Explora, aprende y vive experiencias únicas con nuestra guía</text>
                    break;
            }
        </p>
    </div>
</header>

<!-- Sección de los 3 Sitios Mejor Puntuados -->
<div class="container my-5">
    <h2 class="text-center mb-4 fw-bold">
        @switch (selectedLanguage)
        {
            case "en":
                <text>🏆 Top Rated Sites by Visitors</text>
                break;
            case "pt":
                <text>🏆 Melhores Locais Avaliados</text>
                break;
            default:
                <text>🏆 Mejores Sitios Según Opiniones</text>
                break;
        }
    </h2>

    <div class="row g-4">
        @if (ViewBag.TopSitios != null && ViewBag.TopSitios.Count > 0)
        {
            foreach (var item in ViewBag.TopSitios)
            {
                var sitio = item.Sitio;
                var promedio = Math.Round((double)item.Promedio, 1);
                string imagen = item.ImagenUrl;

                <div class="col-12 col-md-6 col-lg-4">
                    <div class="card h-100 shadow-sm border-0">
                        <div class="ratio ratio-4x3">
                            <img src="@imagen"
                                 class="card-img-top img-fluid object-fit-cover rounded-top"
                                 alt="@sitio.Nombre"
                                 onerror="this.src='/images/default-sitio.jpg'">
                        </div>

                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title fw-bold text-dark">
                                @switch (selectedLanguage)
                                {
                                    case "en":
                                        <text>@(string.IsNullOrEmpty(sitio.NombreIngles) ? sitio.Nombre : sitio.NombreIngles)</text>
                                        break;
                                    case "pt":
                                        <text>@(string.IsNullOrEmpty(sitio.NombrePortugues) ? sitio.Nombre : sitio.NombrePortugues)</text>
                                        break;
                                    default:
                                        <text>@sitio.Nombre</text>
                                        break;
                                }
                            </h5>
                            <p class="card-text text-muted mb-2">
                                <i class="fas fa-star text-warning"></i> @promedio.ToString("0.0") / 5
                            </p>
                            <p class="card-text flex-grow-1 text-secondary">
                                @{
                                    string descripcion = "";
                                    switch (selectedLanguage)
                                    {
                                        case "en":
                                            descripcion = string.IsNullOrEmpty(sitio.DescripcionIngles) ? sitio.Descripcion : sitio.DescripcionIngles;
                                            break;
                                        case "pt":
                                            descripcion = string.IsNullOrEmpty(sitio.DescripcionPortugues) ? sitio.Descripcion : sitio.DescripcionPortugues;
                                            break;
                                        default:
                                            descripcion = sitio.Descripcion ?? "";
                                            break;
                                    }

                                    if (!string.IsNullOrEmpty(descripcion) && descripcion.Length > 100)
                                    {
                                        descripcion = descripcion.Substring(0, 100) + "...";
                                    }
                                }
                                @descripcion
                            </p>
                            <a asp-controller="Home" asp-action="Details" asp-route-id="@sitio.Id"
                               class="btn btn-primary mt-auto">
                                @switch (selectedLanguage)
                                {
                                    case "en":
                                        <text>View Details</text>
                                        break;
                                    case "pt":
                                        <text>Ver Detalhes</text>
                                        break;
                                    default:
                                        <text>Ver Detalles</text>
                                        break;
                                }
                            </a>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="col-12 text-center text-muted py-5">
                <i class="fas fa-map-marker-alt fa-3x mb-3"></i>
                <p class="fs-5">
                    @switch (selectedLanguage)
                    {
                        case "en":
                            <text>No rated sites yet.</text>
                            break;
                        case "pt":
                            <text>Ainda não há locais avaliados.</text>
                            break;
                        default:
                            <text>No hay sitios puntuados aún.</text>
                            break;
                    }
                </p>
            </div>
        }
    </div>
</div>

<!-- Sección de Tipos de Tours -->
<div class="container my-5">
    <h2 class="text-center mb-4 fw-bold">
        @switch (selectedLanguage)
        {
            case "en":
                <text>🌍 Tour Types and Experiences</text>
                break;
            case "pt":
                <text>🌍 Tipos de Tours e Experiências</text>
                break;
            default:
                <text>🌍 Tipos de Tours y Experiencias</text>
                break;
        }
    </h2>

    <div class="row g-4">
        @if (Model != null && Model.Any())
        {
            foreach (var tipo in Model)
            {
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="card h-100 shadow-sm border-0">
                        <div class="ratio ratio-4x3">
                            <img src="@(tipo.ImagenUrl ?? "/images/default-tipo.jpg")"
                                 class="card-img-top img-fluid object-fit-cover rounded-top"
                                 alt="@tipo.Nombre"
                                 onerror="this.src='/images/default-tipo.jpg'">
                        </div>

                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title fw-bold text-dark">
                                @switch (selectedLanguage)
                                {
                                    case "en":
                                        <text>@(string.IsNullOrEmpty(tipo.NombreIngles) ? tipo.Nombre : tipo.NombreIngles)</text>
                                        break;
                                    case "pt":
                                        <text>@(string.IsNullOrEmpty(tipo.NombrePortugues) ? tipo.Nombre : tipo.NombrePortugues)</text>
                                        break;
                                    default:
                                        <text>@tipo.Nombre</text>
                                        break;
                                }
                            </h5>

                            <p class="card-text flex-grow-1 text-secondary">
                                @{
                                    string tipoDescripcion = "";
                                    switch (selectedLanguage)
                                    {
                                        case "en":
                                            tipoDescripcion = tipo.DescripcionIngles ?? tipo.Descripcion ?? "";
                                            break;
                                        case "pt":
                                            tipoDescripcion = tipo.DescripcionPortugues ?? tipo.Descripcion ?? "";
                                            break;
                                        default:
                                            tipoDescripcion = tipo.Descripcion ?? "";
                                            break;
                                    }

                                    if (!string.IsNullOrEmpty(tipoDescripcion) && tipoDescripcion.Length > 120)
                                    {
                                        tipoDescripcion = tipoDescripcion.Substring(0, 120) + "...";
                                    }
                                }
                                @tipoDescripcion
                            </p>

                            <div class="mt-auto">
                                <a asp-controller="Home"
                                   asp-action="PorTipo"
                                   asp-route-tipoId="@tipo.TipoId"
                                   class="btn btn-primary w-100">
                                    @switch (selectedLanguage)
                                    {
                                        case "en":
                                            <text>View Sites</text>
                                            break;
                                        case "pt":
                                            <text>Ver Locais</text>
                                            break;
                                        default:
                                            <text>Ver Sitios</text>
                                            break;
                                    }
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="col-12 text-center text-muted py-5">
                <i class="fas fa-route fa-3x mb-3"></i>
                <p class="fs-5">
                    @switch (selectedLanguage)
                    {
                        case "en":
                            <text>No tours registered yet.</text>
                            break;
                        case "pt":
                            <text>Nenhum tipo de tour registrado ainda.</text>
                            break;
                        default:
                            <text>No hay tipos de tours registrados todavía.</text>
                            break;
                    }
                </p>
            </div>
        }
    </div>
</div>

<!-- Script para manejar imágenes rotas -->
@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const defaultImage = 'https://upload.wikimedia.org/wikipedia/commons/1/14/No_Image_Available.jpg';

            // Manejar imágenes que no cargan
            document.querySelectorAll('img').forEach(img => {
                img.addEventListener('error', function() {
                    if (this.src.includes(defaultImage)) return;

                    // Preservar la clase original y agregar clase de error
                    this.classList.add('image-load-failed');

                    // Reemplazar con imagen por defecto
                    this.src = defaultImage;

                    // Mejorar el alt si es necesario
                    if (!this.alt) {
                        this.alt = 'Imagen no disponible';
                    }
                });

                // Agregar clase cuando la imagen carga correctamente
                img.addEventListener('load', function() {
                    this.classList.add('image-loaded-successfully');
                    this.classList.remove('image-load-failed');
                });
            });
        });
    </script>

    <!-- Incluir Font Awesome para íconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
}